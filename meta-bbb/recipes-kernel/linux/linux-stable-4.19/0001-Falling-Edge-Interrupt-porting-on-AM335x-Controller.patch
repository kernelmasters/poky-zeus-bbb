From cb4bbb7ce608a1da7049cb97a23479f3c2b04bb0 Mon Sep 17 00:00:00 2001
From: boddu kishore kumar <kishore@kernelmasters.org>
Date: Sat, 23 Jan 2021 12:23:34 +0530
Subject: [PATCH] Falling Edge Interrupt porting on AM335x Controller

---
 arch/arm/boot/dts/km-bbb-am335x.dts | 23 +++++++++++++++++++++++
 drivers/input/keyboard/gpio_keys.c  |  4 ++++
 2 files changed, 27 insertions(+)

diff --git a/arch/arm/boot/dts/km-bbb-am335x.dts b/arch/arm/boot/dts/km-bbb-am335x.dts
index f760193df..89a55d302 100644
--- a/arch/arm/boot/dts/km-bbb-am335x.dts
+++ b/arch/arm/boot/dts/km-bbb-am335x.dts
@@ -33,7 +33,30 @@
 
 };
 
+/ {
+        gpio_keys: wakeup_key0 {
+                compatible = "gpio-keys";
+                pinctrl-names = "default";
+                /*pinctrl-0 = <&gpiokey_pins>;*/
+                autorepeat;
+
+	        switch11 {
+                        label = "wakeup";
+                        linux,code = <143>;
+                        /*linux,code = <KEY_WAKEUP>;*/
+                        gpios = <&gpio0 11 GPIO_ACTIVE_LOW>;
+                        wakeup-source;
+                };
+
+	};
+};
+
 &am33xx_pinmux {
+        gpiokey_pins: pinmux_gpiokey_pins {
+                pinctrl-single,pins = <
+                        AM33XX_IOPAD(0x8DC, PIN_INPUT_PULLUP | MUX_MODE7)       /* lcd_data15.gpio0_11 */
+                >;
+        };
         uart0_pins: pinmux_uart0_pins {
                 pinctrl-single,pins = <
                         AM33XX_IOPAD(0x970, PIN_INPUT_PULLUP | MUX_MODE0)       /* uart0_rxd.uart0_rxd */
diff --git a/drivers/input/keyboard/gpio_keys.c b/drivers/input/keyboard/gpio_keys.c
index 492a971b9..f9d1931cf 100644
--- a/drivers/input/keyboard/gpio_keys.c
+++ b/drivers/input/keyboard/gpio_keys.c
@@ -778,6 +778,7 @@ static int gpio_keys_probe(struct platform_device *pdev)
 	int i, error;
 	int wakeup = 0;
 
+	printk("%s:%s:%d\n",__FILE__,__func__,__LINE__);
 	if (!pdata) {
 		pdata = gpio_keys_get_devtree_pdata(dev);
 		if (IS_ERR(pdata))
@@ -872,6 +873,7 @@ static int gpio_keys_probe(struct platform_device *pdev)
 
 	device_init_wakeup(dev, wakeup);
 
+	printk("%s:%s:%d\n",__FILE__,__func__,__LINE__);
 	return 0;
 }
 
@@ -1026,11 +1028,13 @@ static struct platform_driver gpio_keys_device_driver = {
 
 static int __init gpio_keys_init(void)
 {
+	printk("%s:%s:%d\n",__FILE__,__func__,__LINE__);
 	return platform_driver_register(&gpio_keys_device_driver);
 }
 
 static void __exit gpio_keys_exit(void)
 {
+	printk("%s:%s:%d\n",__FILE__,__func__,__LINE__);
 	platform_driver_unregister(&gpio_keys_device_driver);
 }
 
-- 
2.17.1

